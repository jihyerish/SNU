<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"/>
<link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
<script src="../mindless.js"></script>
<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
<script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
<script type="text/javascript">
window.addEventListener("load", function(){
        MILE.setAppID("connect");
        MILE.setAuthor("snu");
        MILE.setVersion("0.1");
        MILE.setAppURL("http://localhost:8001/mobile/");
        MILE.showMileURL(true);
        MILE.showDebug(false);
        MILE.init();
        // ready
        });
MILE.on('ready', function(data, from) {
        console.log("From server considering ready: " + data);
        });
MILE.on('game_start', function(data, from) {
        console.log("From server considering ready: " + data);
        $('#willStart').empty();
        $('#willStart').append("Game will start in <span id=\"count\">5</span> seconds.");
        var counter = 5;
        setInterval(function(){
            counter--;
            if (counter >= 0){
                span = document.getElementById("count");
                span.innerHTML = counter;
                }
            if (counter == 0){
                clearInterval(counter);
                $.mobile.changePage("#background");
                MILE.send('initPlayerInfo', '');
                }
            }, 1000);
        });
MILE.on('playerInfo', function(data, from) {
        console.log(data);
        var info = JSON.parse(data);
        var otherPlayers = info.otherPlayers; // str array
        var job = info.job; // image, str(name), str(mission)
        var character = info.character; // image, str(name), str(effect)
        var curLife = info.curLife; // number
        var maxLife = info.maxLife;
        var mounted = info.mountedCards; // {image, cardName} array
        var inHand = info.inHandCards; //array
        var jobImage = "<img src=\"" + job.image + "\" width=\"50\" heigth=\"100\">";
        var jobName = "<p id=\"jobName\"> JOB: " + job.name + "</p>";
        var jobMission = "<p id=\"jobMission\"> MISSION: " + job.mission + "</p>";

        var characterImage = "<img src=\"" + character.image + "\" width=\"50\" heigth=\"100\">";
        var charName = "<p id=\"charName\"> CHAR: " + character.name + "</p>";
        var charEffect = "<p id=\"charEffect\"> EFFECT: " + character.effect + "</p>";
        var life = "<p id=\"life\"> LIFE(cur/max): " + curLife + "/" + maxLife +"</p>"
        for(i = 0; i < otherPlayers.length; i++){
            var playerN = "<p id=\"player" + i + "\" >" + otherPlayers[i] + "</p>";
            $('#otherPlayers').append(playerN);
        }
        $('#images').append(jobImage);
        $('#images').append(characterImage);

        $('#contents').append(jobName);
        $('#contents').append(jobMission);
        $('#contents').append(charName);
        $('#contents').append(charEffect);
        for(i = 0; i < mounted.length; i++){
            var cardImageN = "<img src=\"" + mounted[i].image + "\" >";
            var cardDiv = "<div id=\"mountedCard" + i + "\">" + cardImageN + "</div>";
            $('#mountedCards').append(cardDiv);
        }
        for(i = 0; i < inHand.length; i++){
            var cardImageN = "<img src=\"" + inHand[i] + "\" >";
            var cardDiv = "<div id=\"inHandCard" + i + "\">" + cardImageN + "</div>";
            $('#inHandCards').append(cardDiv);
        }
        });
MILE.on('otherPlayerInfo', function(data, from){
        var info = JSON.parse(data);
        var job = info.job; // image, str(name), str(mission)
        /* Other players job show when he/she is a sceriff or is dead */
        var character = info.character; // image, str(name), str(effect)
        var curLife = info.curLife; // number
        var maxLife = info.maxLife;
        var mounted = info.mountedCards; // image array
        var inHand = info.inHandCards; //image, num
        var jobImage = "<img src=\"" + job.image + "\" width=\"50\" heigth=\"100\">";
        var jobName = "<p id=\"jobName\"> JOB: " + job.name + "</p>";
        var jobMission = "<p id=\"jobMission\"> MISSION: " + job.mission + "</p>";

        var characterImage = "<img src=\"" + character.image + "\" width=\"50\" heigth=\"100\">";
        var charName = "<p id=\"charName\"> CHAR: " + character.name + "</p>";
        var charEffect = "<p id=\"charEffect\"> EFFECT: " + character.effect + "</p>";
        var life = "<p id=\"life\"> LIFE(cur/max): " + curLife + "/" + maxLife +"</p>"

        var inHandCardBack = "<img src=\"" + inHand.image + "\" >";
        var inHandCardNum = inHand.num;
        $('#images').append(jobImage);
        $('#images').append(characterImage);

        $('#contents').append(jobName);
        $('#contents').append(jobMission);
        $('#contents').append(charName);
        $('#contents').append(charEffect);
        for(i = 0; i < mounted.length; i++){
            var cardImageN = "<img src=\"" + mounted[i].image + "\" >";
            var cardDiv = "<div id=\"mountedCard" + i + "\">" + cardImageN + "</div>";
            $('#mountedCards').append(cardDiv);
        }
        for(i = 0; i < inHandCardNum; i++){
            var cardDiv = "<div id=\"inHandCard" + i + "\">" + inHandCardBack + "</div>";
            $('#inHandCards').append(cardDiv);
        }
        });
MILE.on('bangCard', function(data, from) {
        // console.log("<img src=\"" + data + "\" width=\"50\" height=\"100\">");
        });
MILE.on('mountedCardInfo', function(data, from){
        $.mobile.changePage('#cardInfo');
        var info = JSON.parse(data);
        var imageSrc = info.image;
        var activated = info.activated;
        var image = "<img src=\"" + imageSrc + "\">";
        $('#cardImage').append(image);
        /* add div attribute if the card is selectable*/
        });
MILE.on('inHandCardInfo', function(data, from){
        $.mobile.changePage('#cardInfo');
        var info = JSON.parse(data);
        var imageSrc = info.image;
        var activated = info.activated;
        var image = "<img src=\"" + imageSrc + "\">";
        $('#cardImage').append(image);
        /* add div attribute if the card is selectable*/
        });
MILE.on('help', function(data, from){
        $.mobile.changePage('#cardExplain');
        var info = JSON.parse(data);
        var helpStr = "<p id=\"helpStr\">" + info.help + "</p>";
        $('#explanation').append(helpStr);

        });
MILE.on('select', function(data, from){
        });

</script>
<script>
$(document).on("pagecreate", "#readyPage", function(){
        $("#ready").on("tap", function(){
            MILE.send("ready", "Client ready");
            });
        });
$(document).on("pagecreate", "#background", function(){
        //TODO: Changed
        MILE.send("playerInfo", "Request basic information");
        $("#otherPlayers").on('tap', function(){
            var id = event.target.id;
            var content = document.getElementById(id).innerHTML;
            MILE.send("otherPlayerInfo", content);
            });
        $("#mountedCards").on('tap', function(){
            var id = event.target.id;/*div id e.g. mountedCardN*/
            var content = document.getElementById(id).innerHTML;
            MILE.send("mountedCardInfo", content);
            });
        $("#inHandCards").on('tap', function(){
            var id = event.target.id;
            var content = document.getElementById(id).innerHTML;
            MILE.send("inHandCardInfo", content);
            });
        /* TODO
           1. Ask server
           - other player list(character names)
           - my information(class Player)
           2. Display information
           - player list to collapsible list
           - my information
           3. Add event listener on each cards
           - If the user tap on the card, make a popup with card image and buttons
           4. Add event listener on each player names
           - If the user tap on the name, ask server to give information about the player and make a popup
         */
        });
$(document).on("pagecreate", "#playerInfo", function(){
        $("#mountedCards").on('tap', function(){
            var id = event.target.id;/*div id e.g. mountedCardN*/
            var content = document.getElementById(id).innerHTML;
            //MILE.send("mountedCardInfo", content);
            });
        /* TODO
           1. Ask server
           Display information
           - player information
           2. Add event listener on each cards
           - If the user tap on the card, make a popup with card image and buttons
         */
        });
$(document).on("pagecreate", "#cardInfo", function(){
        var content; /* img src */
        $("#help").on("tap", function(){
            var content = $(this).siblings("img").prop('outerHTML');
            alert("To check tags: " + content);
            MILE.send("help", content);
            });
        $("#select").on("tap", function(){
            var content = $(this).siblings("img").prop('outerHTML');
            alert("To check tags: " + content);
            MILE.send("select", content);
            });
        /* TODO
           1. Display card image and buttons
           2. Add event listener on each buttons
           - If the user tap on the "Select" button, send the information to the server and close the popup
           - If the user tap on the "Cancel" button, just close the popup
           - If the user tap on the "Help" button, ask server to give information and make a popup
         */
        });
</script>
</head>
<body>
<div data-role="page" id="readyPage">
    <div data-role="main" class="ui-content">
        <p align="center" style="text-align:center; padding-top: 40%; font-size: 20px;" id="willStart"></p>
        <div id="wrapper" align="center" style="text-align:center; padding-top: 20px;">
            <a href="#" class="ui-btn ui-btn-inline ui-corner-all ui-icon-check ui-btn-icon-left" id="ready">Ready</a>
        </div>
    </div>
</div>
<div data-role="page" id="background">
    <div data-role="main" class="ui-content">
        <div data-role="collapsible" data-collapsed="true" id="otherPlayers">

            <h1>Other players </h1>
            <p id="player1"> Suzy Lafayette </p>
            <!-- Character cards of other players are listed. The player can touch the card to check that player's information: character name and features, player's job(if the player is a sceriff), mounted cards on the player side, number of the playing cards the player have, and remaining life. -->
        </div>
        <div id="myInfo">
            <div id="status">
                <p> STATUS </p>
                <div id="images"></div>
                <div id="contents"></div>
            </div>
            <div id="cards">
                <div id="mountedCards">
                    <p> Mounted </p>
                </div>
                <div id="inHandCards">
                    <p> In Hand </p>
                </div>
            </div>
        </div>
    </div>
</div>
<div data-role="page" data-dialog="true" id="playerInfo">
    <div data-role="main" class="ui-content">
        <div id="otherPlayerInfo">
            <div id="status">
                <p> STATUS </p>
                <div id="images"></div>
                <div id="contents"></div>
            </div>
            <div id="cards">
                <div id="mountedCards">
                    <p> Mounted </p>
                </div>
                <div id="inHandCards">
                    <p> In Hand </p>
                </div>
            </div>
        </div>
    </div>
    <!-- Show the information of other players. character card, character name and features, player's job(if the player is a sceriff), mounted cards on the player side, number of the playing cards the player have, and remaining life. The player can see card information by touching the mounted card. -->
</div>
<div data-role="page" data-dialog="true" id="cardInfo">
    <div data-role="main" class="ui-content">
        <div id="cardImage" width="90%" height="60%"></div>
        <div data-role="controlgroup" data-type="horizontal">
            <a href="#" class="ui-btn ui-btn-inline ui-corner-all ui-icon-check ui-btn-icon-left" id="select">Select</a>
            <a href="#" class="ui-btn ui-btn-inline ui-corner-all ui-icon-back ui-btn-icon-left" data-rel="back" id="back">Back</a>
            <a href="#" class="ui-btn ui-btn-inline ui-corner-all ui-icon-info ui-btn-icon-left" id="help">Help</a>
        </div>
    </div>
</div>

<div data-role="page" data-dialog="true" id="cardExplain">
    <!-- Show the explanation of the card when help is selected. -->
    <div data-role="popup" id="explanation" class="ui-content" style="top: 50%">
        <a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn ui-icon-delete ui-btn-icon-notext ui-btn-left">close</a>
    </div>
</div>
</body>
</html>
