<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"/>
<link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
<link rel="stylesheet" type="text/css" href="mobile.css">
<script src="../mindless.js"></script>
<script src="mobile.js"></script>
<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
<script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
<script src="https://unpkg.com/vue"></script>
<script src="../semantic/dist/semantic.min.js"></script>
<script type="text/javascript">
window.addEventListener("load", function(){
        MILE.setAppID("connect");
        MILE.setAuthor("snu");
        MILE.setVersion("0.1");
        MILE.setAppURL("http://localhost:8001/mobile/");
        MILE.showMileURL(true);
        MILE.showDebug(false);
        MILE.init();
        // ready
        });
MILE.on('ready', function(data, from) {
        document.querySelector("#content").innerHTML += "<li>[" + from + "] " + data + "</li>";
        console.log("From server considering ready: " + data);
        });
MILE.on('game_start', function(data, from) {
        document.querySelector("#content").innerHTML += "<li>[" + from + "] " + data + "</li>";
        console.log("From server considering ready: " + data);
        $.mobile.changePage("#background");
        });
MILE.on('playerInfo', function(data, from) {
        var info = JSON.parse(data);
        var otherPlayers = info.otherPlayers; // str array
        var job = info.job; // image, str(name), str(mission)
        var character = info.character; // image, str(name), str(effect)
        var life = info.life; // number
        var mounted = info.mountedCards; // {image, cardName} array
        var inHand = info.inHandCards; //array
        var jobImage = "<img src=\"" + job.image + "\" width=\"50\" heigth=\"100\">";
        var jobName = "<p id=\"jobName\"> JOB: " + job.name + "</p>";
        var jobMission = "<p id=\"jobMission\"> MISSION: " + job.mission + "</p>";
        
        var characterImage = "<img src=\"" + character.image + "\" width=\"50\" heigth=\"100\">";
        var charName = "<p id=\"charName\"> CHAR: " + character.name + "</p>";
        var charEffect = "p id=\"charEffect\"> EFFECT: " + character.effect + "</p>";

        for(i = 0; i < otherPlayers.length; i++){
            var playerN = "<p id=\"player" + i + "\" >" + otherPlayers[i] + "</p>";
            $('#otherPlayers').append(playerN);
        }
        $('#images').append(jobImage);     
        $('#images').append(characterImage);
        
        $('#contents').append(jobName);
        $('#contents').append(jobMission);
        $('#contents').append(charName);
        $('#contents').append(charEffect);
        for(i = 0; i < mounted.length; i++){
            var cardImageN = "<img src=\"" + mounted[i].image + "\" >";
            var cardDiv = "<div id=\"" + mounted[i].name + "\">" + cardImageN + "</div>";
            $('#mountedCards').append(cardDiv);
        }
        for(i = 0; i < inHand.length; i++){
            var cardImageN = "<img src=\"" + inHand[i] + "\" >";
            var cardDiv = "<div id=\"card" +  "i\">" + cardImageN + "</div>";
            $('#inHandCards').append(cardDiv);
        }
        });
MILE.on('bangCard', function(data, from) {
        document.querySelector("#content").innerHTML += data + " width=\"50\" height=\"100\">";
        // console.log("<img src=\"" + data + "\" width=\"50\" height=\"100\">");
        });

</script>
<script>

/*
   Before the game start, there should be ready page to check if the required number of players are connected to the server. If the player tap on the ready button, it will send the server ready signal. When all players connected to the server send the ready signal, server will start game and send the starting signal back.
 */
$("#cardExplain").hide();
$(document).on("pagecreate", "#readyPage", function(){
        $("#ready").on("tap", function(){
            MILE.send("ready", "Ready button!");
            });
        });
$(document).on("pagecreate", "#background", function(){
        // Send server request
        MILE.send("playerInfo", "Give me player information");
        $("#background").on("tap", function(){
            $.mobile.changePage("#cardInfo");
            });
        /* TODO
           1. Ask server
           - other player list(character names)
           - my information(class Player)
           2. Display information
           - player list to collapsible list
           - my information
           3. Add event listener on each cards
           - If the user tap on the card, make a popup with card image and buttons
           4. Add event listener on each player names
           - If the user tap on the name, ask server to give information about the player and make a popup
         */
        });
$(document).on("pagecreate", "#playerInfo", function(){
        /* TODO
           1. Ask server
           Display information
           - player information
           2. Add event listener on each cards
           - If the user tap on the card, make a popup with card image and buttons
         */
        });
$(document).on("pagecreate", "#cardInfo", function(){
        $("#help").on("tap", function(){
            $("#cardExplain").popup("open");
            });
        /* TODO
           1. Display card image and buttons
           2. Add event listener on each buttons
           - If the user tap on the "Select" button, send the information to the server and close the popup
           - If the user tap on the "Cancel" button, just close the popup
           - If the user tap on the "Help" button, ask server to give information and make a popup
         */
        });
$(document).on("pagecreate", "#cardExplain", function(){
        });
/*$("#").on(function() {  //
  alert("Click");
  nextId++;
  var character = "A" + nextId ;
  var job = "\?";
  var life = 4;
  var characteristics = "Characteristics sentence";
  var mounted;
  var playing;
  var content = "<p><a href='#' <div id='player" + nextId + "' data-icon='carat-d'> Player " + nextId + ": " + character + " <img src=''> </div></a></p>"
  $("#otherPlayers").append(content).collapsible("refresh");
  });*/
</script>
</head>
<body>
<div data-role="page" id="readyPage">
    <div data-role="main" class="ui-content">
        <a href="#" class="ui-btn ui-btn-inline ui-corner-all ui-icon-check ui-btn-icon-left" id="ready">Ready</a>
    </div>
</div>
<div data-role="page" id="background">
    <div data-role="main" class="ui-content">
        <div data-role="collapsible" data-collapsed="true" id="otherPlayers">

            <h1>Other players </h1>
            <!-- Character cards of other players are listed. The player can touch the card to check that player's information: character name and features, player's job(if the player is a sceriff), mounted cards on the player side, number of the playing cards the player have, and remaining life. -->
        </div>
        <div id="myInfo">
            <div id="status">
                <p> STATUS </p>
                <div id="images"></div>
                <div id="contents"></div>
            </div>
            <div id="cards">
                <div id="mountedCards">
                    <p> Mounted </p>
                </div>
                <div id="inHandCards">
                    <p> In Hand </p>
                </div>
            </div>
        </div>
    </div>
</div>
<div data-role="page" data-dialog="true" id="playerInfo">
    <div data-role="main" class="ui-content">
        <p>Player information</p>
        <div id="information">
        </div>
        <div id="mountedCards">
        </div>
        <div id="playingCards">
        </div>
    </div>
    <!-- Show the information of other players. character card, character name and features, player's job(if the player is a sceriff), mounted cards on the player side, number of the playing cards the player have, and remaining life. The player can see card information by touching the mounted card. -->
</div>
<div data-role="page" data-dialog="true" id="cardInfo">
    <div data-role="main" class="ui-content">
        <!-- Show the card image and ok/cancel/help button when the card is selected-->
        <div id="cardImage" width="90%" height="60%"></div>
        <div data-role="controlgroup" data-type="horizontal">
            <a href="#" class="ui-btn ui-btn-inline ui-corner-all ui-icon-check ui-btn-icon-left" id="select">Select</a>
            <a href="#" class="ui-btn ui-btn-inline ui-corner-all ui-icon-back ui-btn-icon-left" data-rel="back" id="back">Back</a>
            <a href="#cardExplain" class="ui-btn ui-btn-inline ui-corner-all ui-icon-info ui-btn-icon-left" id="help">Help</a>
        </div>
    </div>
</div>

<div data-role="page" data-dialog="true" id="cardExplain">
    <!-- Show the explanation of the card when help is selected. -->
    <div data-role="popup" id="explanation" class="ui-content" style="top: 50%">
        <a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn ui-icon-delete ui-btn-icon-notext ui-btn-left">close</a>
        <p>Help popup </p>
    </div>
</div>
</body>
</html>
